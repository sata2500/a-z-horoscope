openapi: 3.0.0
info:
  title: Astro API
  description: The API for the astrology application.
  version: 1.0.0
servers:
  - url: /api
paths:
  /admin/stats:
    get:
      summary: Get admin statistics
      description: Retrieves a variety of statistics for the admin dashboard.
      tags:
        - Admin
      security:
        - cookieAuth: []
      responses:
        '200':
          description: A successful response with the statistics.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AdminStatsResponse'
              example:
                success: true
                stats:
                  overview:
                    totalUsers: 1250
                    totalReadings: 5432
                    todayReadings: 45
                    thisWeekReadings: 312
                    thisMonthReadings: 1234
                    totalFavorites: 876
                  zodiacDistribution:
                    - zodiacSign: "aries"
                      count: 100
                    - zodiacSign: "taurus"
                      count: 120
                  readingTypeDistribution:
                    - type: "daily"
                      count: 4000
                    - type: "weekly"
                      count: 1000
                  recentUsers:
                    - id: "user-123"
                      name: "John Doe"
                      email: "john.doe@example.com"
                      zodiacSign: "aries"
                      createdAt: "2023-10-27T10:00:00Z"
                  dailyReadingsLast7Days:
                    - date: "26/10"
                      count: 50
                    - date: "27/10"
                      count: 45
        '401':
          description: Unauthorized
        '500':
          description: Internal Server Error
  /admin/users:
    get:
      summary: Get users
      description: Retrieves a paginated list of users, with optional search.
      tags:
        - Admin
      security:
        - cookieAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
        - name: search
          in: query
          schema:
            type: string
      responses:
        '200':
          description: A successful response with the list of users.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AdminUsersResponse'
              example:
                success: true
                users:
                  - id: "user-123"
                    name: "John Doe"
                    email: "john.doe@example.com"
                    image: "https://example.com/avatar.png"
                    zodiacSign: "aries"
                    role: "USER"
                    emailNotifications: true
                    createdAt: "2023-10-27T10:00:00Z"
                    _count:
                      horoscopeReadings: 10
                      favoriteReadings: 2
                pagination:
                  page: 1
                  limit: 10
                  total: 1
                  totalPages: 1
        '401':
          description: Unauthorized
        '500':
          description: Internal Server Error
  /astrology/natal-chart:
    post:
      summary: Calculate natal chart
      description: Calculates the natal chart for a user based on their birth information.
      tags:
        - Astrology
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NatalChartRequest'
            example:
              birthDate: "1990-01-15T10:30:00Z"
              birthTime: "10:30"
              latitude: 40.7128
              longitude: -74.0060
              houseSystem: "P"
      responses:
        '200':
          description: A successful response with the calculated natal chart.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NatalChartResponse'
        '400':
          description: Bad Request - Missing or invalid parameters.
        '401':
          description: Unauthorized
        '500':
          description: Internal Server Error
  /astrology/transit:
    post:
      summary: Calculate transits
      description: Calculates the transits for a specific date.
      tags:
        - Astrology
      security:
        - cookieAuth: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TransitRequest'
            example:
              date: "2023-10-27"
      responses:
        '200':
          description: A successful response with the calculated transits.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TransitResponse'
        '400':
          description: Bad Request - Invalid date format.
        '401':
          description: Unauthorized
        '500':
          description: Internal Server Error
  /favorites:
    get:
      summary: Get favorite readings
      description: Retrieves a list of the user's favorite readings.
      tags:
        - Favorites
      security:
        - cookieAuth: []
      responses:
        '200':
          description: A successful response with the list of favorite readings.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FavoritesResponse'
        '401':
          description: Unauthorized
        '500':
          description: Internal Server Error
  /favorites/toggle:
    post:
      summary: Toggle favorite
      description: Adds or removes a reading from the user's favorites.
      tags:
        - Favorites
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ToggleFavoriteRequest'
            example:
              readingId: "reading-123"
      responses:
        '200':
          description: A successful response indicating the new favorite status.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ToggleFavoriteResponse'
        '400':
          description: Bad Request - Invalid request data.
        '401':
          description: Unauthorized
        '404':
          description: Not Found - Reading not found.
        '500':
          description: Internal Server Error
  /horoscope/compatibility:
    post:
      summary: Get compatibility analysis
      description: Generates a compatibility analysis between two zodiac signs.
      tags:
        - Horoscope
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CompatibilityRequest'
            example:
              sign1: "aries"
              sign2: "leo"
      responses:
        '200':
          description: A successful response with the compatibility analysis.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CompatibilityResponse'
        '400':
          description: Bad Request - Invalid zodiac signs.
        '401':
          description: Unauthorized
        '500':
          description: Internal Server Error
  /horoscope/daily:
    post:
      summary: Get daily horoscope
      description: Generates or retrieves the daily horoscope for a zodiac sign.
      tags:
        - Horoscope
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/HoroscopeRequest'
            example:
              zodiacSign: "aries"
      responses:
        '200':
          description: A successful response with the daily horoscope reading.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HoroscopeResponse'
        '400':
          description: Bad Request - Invalid zodiac sign.
        '401':
          description: Unauthorized
        '500':
          description: Internal Server Error
  /horoscope/history:
    get:
      summary: Get horoscope history
      description: Retrieves the user's horoscope reading history.
      tags:
        - Horoscope
      security:
        - cookieAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
        - name: zodiacSign
          in: query
          schema:
            type: string
        - name: readingType
          in: query
          schema:
            type: string
      responses:
        '200':
          description: A successful response with the horoscope history.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HistoryResponse'
        '400':
          description: Bad Request - Invalid query parameters.
        '401':
          description: Unauthorized
        '500':
          description: Internal Server Error
  /horoscope/monthly:
    post:
      summary: Get monthly horoscope
      description: Generates or retrieves the monthly horoscope for a zodiac sign.
      tags:
        - Horoscope
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/HoroscopeRequest'
            example:
              zodiacSign: "aries"
      responses:
        '200':
          description: A successful response with the monthly horoscope reading.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HoroscopeResponse'
        '400':
          description: Bad Request - Invalid zodiac sign.
        '401':
          description: Unauthorized
        '500':
          description: Internal Server Error
  /horoscope/weekly:
    post:
      summary: Get weekly horoscope
      description: Generates or retrieves the weekly horoscope for a zodiac sign.
      tags:
        - Horoscope
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/HoroscopeRequest'
            example:
              zodiacSign: "aries"
      responses:
        '200':
          description: A successful response with the weekly horoscope reading.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HoroscopeResponse'
        '400':
          description: Bad Request - Invalid zodiac sign.
        '401':
          description: Unauthorized
        '500':
          description: Internal Server Error
  /journal:
    post:
      summary: Create journal entry
      description: Creates a new journal entry.
      tags:
        - Journal
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/JournalEntryRequest'
            example:
              title: "My first journal entry"
              content: "Today was a good day."
              mood: 8
              tags:
                - "personal"
                - "reflection"
              date: "2023-10-27T10:00:00Z"
      responses:
        '200':
          description: A successful response with the created journal entry.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JournalEntryResponse'
        '400':
          description: Bad Request - Invalid request data.
        '401':
          description: Unauthorized
        '429':
          description: Too Many Requests
        '500':
          description: Internal Server Error
    get:
      summary: Get journal entries
      description: Retrieves a list of journal entries.
      tags:
        - Journal
      security:
        - cookieAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
        - name: mood
          in: query
          schema:
            type: string
        - name: tag
          in: query
          schema:
            type: string
        - name: startDate
          in: query
          schema:
            type: string
            format: date
        - name: endDate
          in: query
          schema:
            type: string
            format: date
        - name: search
          in: query
          schema:
            type: string
      responses:
        '200':
          description: A successful response with the list of journal entries.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JournalEntriesResponse'
        '401':
          description: Unauthorized
        '500':
          description: Internal Server Error
  /journal/{id}:
    get:
      summary: Get journal entry
      description: Retrieves a single journal entry by its ID.
      tags:
        - Journal
      security:
        - cookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: A successful response with the journal entry.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JournalEntryResponse'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Not Found
        '500':
          description: Internal Server Error
    put:
      summary: Update journal entry
      description: Updates a journal entry.
      tags:
        - Journal
      security:
        - cookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/JournalEntryRequest'
            example:
              title: "Updated journal entry"
              content: "Today was a great day."
              mood: 9
              tags:
                - "personal"
                - "reflection"
                - "updated"
      responses:
        '200':
          description: A successful response with the updated journal entry.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JournalEntryResponse'
        '400':
          description: Bad Request - Invalid request data.
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Not Found
        '500':
          description: Internal Server Error
    delete:
      summary: Delete journal entry
      description: Deletes a journal entry.
      tags:
        - Journal
      security:
        - cookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: A successful response indicating the entry was deleted.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeleteResponse'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Not Found
        '500':
          description: Internal Server Error
  /journal/analyze:
    post:
      summary: Analyze journal entry
      description: Analyzes a journal entry or a set of entries.
      tags:
        - Journal
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AnalyzeJournalRequest'
            example:
              entryId: "entry-123"
              analyzeTransits: true
              findPatterns: false
      responses:
        '200':
          description: A successful response with the analysis.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AnalyzeJournalResponse'
        '400':
          description: Bad Request - Invalid request data.
        '401':
          description: Unauthorized
        '404':
          description: Not Found
        '500':
          description: Internal Server Error
  /public/horoscope/daily:
    get:
      summary: Get public daily horoscope
      description: Retrieves the public daily horoscope for a zodiac sign.
      tags:
        - Public
      parameters:
        - name: sign
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: A successful response with the public daily horoscope.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PublicHoroscopeResponse'
        '400':
          description: Bad Request - Invalid zodiac sign.
        '500':
          description: Internal Server Error
  /public/horoscope/monthly:
    get:
      summary: Get public monthly horoscope
      description: Retrieves the public monthly horoscope for a zodiac sign.
      tags:
        - Public
      parameters:
        - name: sign
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: A successful response with the public monthly horoscope.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PublicHoroscopeResponse'
        '400':
          description: Bad Request - Invalid zodiac sign.
        '500':
          description: Internal Server Error
  /public/horoscope/weekly:
    get:
      summary: Get public weekly horoscope
      description: Retrieves the public weekly horoscope for a zodiac sign.
      tags:
        - Public
      parameters:
        - name: sign
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: A successful response with the public weekly horoscope.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PublicHoroscopeResponse'
        '400':
          description: Bad Request - Invalid zodiac sign.
        '500':
          description: Internal Server Error
  /user/notification-settings:
    post:
      summary: Update notification settings
      description: Updates the user's notification settings.
      tags:
        - User
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NotificationSettingsRequest'
            example:
              emailNotifications: true
              preferences:
                daily: true
                weekly: false
                monthly: false
      responses:
        '200':
          description: A successful response with the updated settings.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotificationSettingsResponse'
        '400':
          description: Bad Request - Invalid data format.
        '401':
          description: Unauthorized
        '500':
          description: Internal Server Error
    get:
      summary: Get notification settings
      description: Retrieves the user's notification settings.
      tags:
        - User
      security:
        - cookieAuth: []
      responses:
        '200':
          description: A successful response with the notification settings.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotificationSettingsResponse'
        '401':
          description: Unauthorized
        '404':
          description: Not Found
        '500':
          description: Internal Server Error
  /user/update-zodiac:
    post:
      summary: Update zodiac sign
      description: Updates the user's zodiac sign based on their birth date.
      tags:
        - User
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateZodiacRequest'
            example:
              birthDate: "1990-01-15T10:30:00Z"
      responses:
        '200':
          description: A successful response with the updated zodiac sign.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UpdateZodiacResponse'
        '400':
          description: Bad Request - Invalid input.
        '401':
          description: Unauthorized
        '500':
          description: Internal Server Error
components:
  schemas:
    AdminStatsResponse:
      type: object
      properties:
        success:
          type: boolean
        stats:
          type: object
    AdminUsersResponse:
      type: object
      properties:
        success:
          type: boolean
        users:
          type: array
          items:
            type: object
            properties:
              id:
                type: string
              name:
                type: string
              email:
                type: string
              image:
                type: string
              zodiacSign:
                type: string
              role:
                type: string
              emailNotifications:
                type: boolean
              createdAt:
                type: string
                format: date-time
              _count:
                type: object
                properties:
                  horoscopeReadings:
                    type: integer
                  favoriteReadings:
                    type: integer
        pagination:
          type: object
          properties:
            page:
              type: integer
            limit:
              type: integer
            total:
              type: integer
            totalPages:
              type: integer
    NatalChartRequest:
      type: object
      properties:
        birthDate:
          type: string
          format: date-time
        birthTime:
          type: string
        latitude:
          type: number
        longitude:
          type: number
        houseSystem:
          type: string
    NatalChartResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
    TransitRequest:
      type: object
      properties:
        date:
          type: string
          format: date
    TransitResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
    FavoritesResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: array
          items:
            type: object
    ToggleFavoriteRequest:
      type: object
      properties:
        readingId:
          type: string
    ToggleFavoriteResponse:
      type: object
      properties:
        success:
          type: boolean
        isFavorite:
          type: boolean
        message:
          type: string
    CompatibilityRequest:
      type: object
      properties:
        sign1:
          type: string
        sign2:
          type: string
    CompatibilityResponse:
      type: object
      properties:
        analysis:
          type: string
        sign1Info:
          type: object
        sign2Info:
          type: object
    HoroscopeRequest:
      type: object
      properties:
        zodiacSign:
          type: string
    HoroscopeResponse:
      type: object
      properties:
        reading:
          type: string
        cached:
          type: boolean
    HistoryResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: array
          items:
            type: object
        pagination:
          type: object
    JournalEntryRequest:
      type: object
      properties:
        title:
          type: string
        content:
          type: string
        mood:
          type: number
        tags:
          type: array
          items:
            type: string
        date:
          type: string
          format: date-time
    JournalEntryResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
    JournalEntriesResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            entries:
              type: array
              items:
                type: object
            total:
              type: integer
            page:
              type: integer
            totalPages:
              type: integer
    DeleteResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
    AnalyzeJournalRequest:
      type: object
      properties:
        entryId:
          type: string
        analyzeTransits:
          type: boolean
        findPatterns:
          type: boolean
    AnalyzeJournalResponse:
      type: object
      properties:
        success:
          type: boolean
        analysis:
          type: string
    PublicHoroscopeResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
    NotificationSettingsRequest:
      type: object
      properties:
        emailNotifications:
          type: boolean
        preferences:
          type: object
          properties:
            daily:
              type: boolean
            weekly:
              type: boolean
            monthly:
              type: boolean
    NotificationSettingsResponse:
      type: object
      properties:
        success:
          type: boolean
        emailNotifications:
          type: boolean
        preferences:
          type: object
          properties:
            daily:
              type: boolean
            weekly:
              type: boolean
            monthly:
              type: boolean
    UpdateZodiacRequest:
      type: object
      properties:
        birthDate:
          type: string
          format: date-time
    UpdateZodiacResponse:
      type: object
      properties:
        success:
          type: boolean
        zodiacSign:
          type: string
        birthDate:
          type: string
          format: date-time
  securitySchemes:
    cookieAuth:
      type: apiKey
      in: cookie
      name: next-auth.session-token
